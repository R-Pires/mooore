name: ğŸš€ è‡ªåŠ¨å‘å¸ƒæ’ä»¶ Release

on:
  push:
    tags:
      - 'v*' # åªæœ‰æ¨é€åˆ°ä»¥ v å¼€å¤´çš„æ ‡ç­¾ï¼ˆå¦‚ v1.0.1ï¼‰æ‰ä¼šè§¦å‘

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    # å…³é”®ï¼šèµ‹äºˆ Actions å†™å…¥ Release çš„æƒé™
    permissions:
      contents: write

    steps:
      - name: ğŸ“¥ æ‹‰å–ä»£ç 
        uses: actions/checkout@v6

      - name: ğŸ› ï¸ å®‰è£… pnpm
        uses: pnpm/action-setup@v4

      - name: ğŸŸ¢ è®¾ç½® Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 24
          cache: 'pnpm'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pnpm install

      - name: ğŸ—ï¸ ç¼–è¯‘é¡¹ç›®
        run: pnpm run build

      - name: ğŸ§ª æ‰§è¡Œåå¤„ç†è„šæœ¬
        run: node post-build.ts # ç¡®ä¿ä½ çš„è„šæœ¬ä¼šå°†äº§ç‰©ç§»è‡³ chrome-extension ç›®å½•

    #   - name: ğŸ¤ å‹ç¼©æ’ä»¶åŒ…
    #     # å°†å‡†å¤‡å¥½çš„ chrome-extension æ–‡ä»¶å¤¹å‹ç¼©
    #     run: zip -r mooore-${{ github.ref_name }}.zip chrome-extension/*

      - name: ğŸ¤ å‡†å¤‡å¹¶å‹ç¼©æ’ä»¶åŒ…
        run: |
          # 1. å®šä¹‰æœ€ç»ˆæ–‡ä»¶å¤¹åç§°ï¼ˆå¦‚ beyond-new-tab-v1.0.1ï¼‰
          export FOLDER_NAME="mooore-${{ github.ref_name }}"
        
          # 2. å°† post-build.ts å¤„ç†å®Œçš„ dist æ–‡ä»¶å¤¹æ”¹åä¸ºå¸¦ç‰ˆæœ¬çš„åå­—
          # è¿™æ ·è§£å‹å‡ºæ¥åçš„ç›®å½•å°±æ˜¯ mooore-v1.0.1
          mv dist $FOLDER_NAME
        
          # 3. å‹ç¼©è¿™ä¸ªæ–‡ä»¶å¤¹
          zip -r $FOLDER_NAME.zip $FOLDER_NAME

      - name: ğŸ“¢ åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          # å‘Šè¯‰ GitHub å‘å¸ƒå“ªä¸ªæ–‡ä»¶
          files: mooore-*.zip
          # Release çš„æ ‡é¢˜å’Œæè¿°
          name: Release ${{ github.ref_name }}
          body: |
            ## ğŸ‰ æ–°ç‰ˆæœ¬å‘å¸ƒï¼
            è¿™æ˜¯ç”± GitHub Actions è‡ªåŠ¨æ„å»ºçš„äº§ç‰©ã€‚
            
            ### ğŸ“ æ›´æ–°å†…å®¹
            - è‡ªåŠ¨åŒæ­¥ç‰ˆæœ¬å·: ${{ github.ref_name }}
            - æ ¸å¿ƒåŠŸèƒ½å·²å°±ç»ª
            
            ### ğŸ› ï¸ å®‰è£…æ–¹æ³•
            1. ä¸‹è½½ä¸‹æ–¹çš„ `mooore-${{ github.ref_name }}.zip`
            2. è§£å‹åˆ°æœ¬åœ°æ–‡ä»¶å¤¹
            3. åœ¨ Chrome æ‰©å±•ç¨‹åºé¡µé¢å¼€å¯â€œå¼€å‘è€…æ¨¡å¼â€
            4. ç‚¹å‡»â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºâ€ï¼Œé€‰æ‹©è¯¥æ–‡ä»¶å¤¹
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # è‡ªåŠ¨ç”Ÿæˆçš„æƒé™ä»¤ç‰Œ